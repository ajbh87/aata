const webpack = require('webpack');
const path = require('path');
const CompressionPlugin = require("compression-webpack-plugin");

module.exports = {
    entry: './init.js',
    output: {
        filename: './js-bundles/scripts.min.js',
        path: path.resolve(__dirname)
    },
    module: {
        rules: [{
        test: /\.js$/,
        exclude: /(node_modules|bower_components)/,
        use: {
            loader: 'babel-loader',
            options: {
                presets: ['es2015']
            }
        }
    }
    ]},
    plugins: [ 
        new webpack.optimize.UglifyJsPlugin({
            mangle: {
                except: [
                'angular',
                'ngSanitize',
                'ngResource',
                '$document',
                'exports',
                'require',
                '$compile',
                '$sce',
                '$q',
                '$resource',
                '$templateCache',
                '$timeout',
                '$document']
             },
            sourceMap: true
        }),
        new CompressionPlugin({
            asset: "[path].gz[query]",
            algorithm: "gzip",
            test: /\.(js|html)$/,
            threshold: 10240,
            minRatio: 0.8
        })
    ]
};
